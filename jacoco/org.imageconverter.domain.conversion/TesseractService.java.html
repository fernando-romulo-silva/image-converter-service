<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TesseractService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">image-converter-service</a> &gt; <a href="index.source.html" class="el_package">org.imageconverter.domain.conversion</a> &gt; <span class="el_source">TesseractService.java</span></div><h1>TesseractService.java</h1><pre class="source lang-java linenums">package org.imageconverter.domain.conversion;

import static org.apache.commons.lang3.exception.ExceptionUtils.getRootCauseMessage;

import java.awt.Rectangle;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.util.Objects;

import javax.imageio.ImageIO;

import org.imageconverter.infra.exception.ConversionException;
import org.imageconverter.infra.exception.TesseractConversionException;
import org.imageconverter.infra.exception.TesseractNotSetException;
import org.imageconverter.util.BeanUtil;
import org.imageconverter.util.logging.Loggable;
//import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.stereotype.Service;

import net.sourceforge.tess4j.ITesseract;
import net.sourceforge.tess4j.TesseractException;

/**
 * A Java class to access tesseract application
 * 
 * @author Fernando Romulo da Silva
 */
@Service
@Loggable
<span class="fc" id="L30">public class TesseractService {</span>

    // @PreAuthorize(&quot;hasAuthority('ADMIN') or @accessChecker.hasLocalAccess(authentication)&quot;)
    /**
     * Convert a file image to text.
     * 
     * @param fileName  The file's name
     * @param fileBytes A file that will be convert
     * @return A {@link String} object with the conversion
     */
    public String convert(final String fileName, final byte[] fileBytes) {

<span class="fc" id="L42">	final var tesseractBeanProvider = BeanUtil.getBeanProviderFrom(ITesseract.class);</span>
<span class="fc" id="L43">	final var tesseract = tesseractBeanProvider.getObject();</span>

<span class="pc bpc" id="L45" title="1 of 2 branches missed.">	if (Objects.isNull(tesseract)) {</span>
<span class="nc" id="L46">	    throw new TesseractNotSetException();</span>
	}

	try {

<span class="fc" id="L51">	    final var bufferedImage = ImageIO.read(new ByteArrayInputStream(fileBytes));</span>

<span class="fc" id="L53">	    return tesseract.doOCR(bufferedImage);</span>

<span class="fc" id="L55">	} catch (final IllegalArgumentException ex) {</span>

<span class="fc" id="L57">	    throw new TesseractNotSetException(ex);</span>

<span class="fc" id="L59">	} catch (final IOException ex) {</span>

<span class="fc" id="L61">	    final Object[] params = { fileName, getRootCauseMessage(ex) };</span>

<span class="fc" id="L63">	    throw new ConversionException(&quot;{exception.conversionExceptionIO}&quot;, ex, params);</span>

<span class="fc" id="L65">	} catch (final TesseractException | Error ex) {</span>

<span class="fc" id="L67">	    final Object[] params = { fileName, getRootCauseMessage(ex) };</span>

<span class="fc" id="L69">	    throw new TesseractConversionException(&quot;{exception.conversionExceptionIO}&quot;, ex, params);</span>

//	} catch (final Exception ex) {
//
//	    final var msg = format(&quot;Unexpected error: ''{0}''.&quot;, getRootCauseMessage(ex));
//	    throw new ImageConvertServiceException(msg, ex);
	}
    }

    /**
     * Convert a file image to text.
     * 
     * @param fileName  The file's name
     * @param fileBytes A file that will be convert
     * @param xAxis     The image's x coordinate
     * @param yAxis     The image's y coordinate
     * @param width     The image's width in pixels
     * @param height    The image's height in pixels
     * 
     * @return A {@link String} object with the conversion
     */
    public String convert(final String fileName, final byte[] fileBytes, final int xAxis, final int yAxis, final int width, final int height) {

<span class="fc" id="L92">	final var tesseractTess4j = BeanUtil.getBeanProviderFrom(ITesseract.class).getIfAvailable();</span>

<span class="pc bpc" id="L94" title="1 of 2 branches missed.">	if (Objects.isNull(tesseractTess4j)) {</span>
<span class="nc" id="L95">	    throw new TesseractNotSetException();</span>
	}

	try {

<span class="fc" id="L100">	    final var bufferedImage = ImageIO.read(new ByteArrayInputStream(fileBytes));</span>

<span class="fc" id="L102">	    return tesseractTess4j.doOCR(bufferedImage, new Rectangle(xAxis, yAxis, width, height));</span>

<span class="nc" id="L104">	} catch (final IllegalArgumentException ex) {</span>

<span class="nc" id="L106">	    throw new TesseractNotSetException(ex);</span>

<span class="fc" id="L108">	} catch (final IOException ex) {</span>

<span class="fc" id="L110">	    final Object[] params = { fileName, getRootCauseMessage(ex), xAxis, yAxis, width, height };</span>

<span class="fc" id="L112">	    throw new ConversionException(&quot;{exception.conversionAreaExceptionIO}&quot;, ex, params);</span>

<span class="fc" id="L114">	} catch (final TesseractException | Error ex) {</span>

<span class="fc" id="L116">	    final Object[] params = { fileName, getRootCauseMessage(ex), xAxis, yAxis, width, height };</span>

<span class="fc" id="L118">	    throw new TesseractConversionException(&quot;{exception.conversionAreaTesseractError}&quot;, ex, params);</span>

//	} catch (final Exception ex) {
//
//	    final var msg = format(&quot;Unexpected error: ''{0}'', X {1}, Y {2}, Width {3} and Heigh {4}.&quot;, getRootCauseMessage(ex), xAxis, yAxis, width, height);
//	    throw new ImageConvertServiceException(msg, ex);
	}
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>